import{c as g,u as z,I as G,a as H,o as Q,j as U,k as W,t as x,d as l,i,b as c,X as u,e as C,l as Y,f as y,h as q,n as Z}from"./index-Dgi8wYgQ.js";import{c as ee,a as j}from"./authService-BoypurrR.js";var te=x('<div class=space-y-5><label></label><div class="flex justify-between gap-2">'),se=x("<div><p>"),ne=x("<button type=submit>"),oe=x('<div class="text-center mt-4"><p> <button type=button>'),re=x("<div>"),ae=x('<div class="max-w-md w-full space-y-8"><div><h1></h1><p> '),le=x("<input type=text inputmode=numeric pattern=[0-9]* maxlength=1 autocomplete=off>");const we=()=>{const[a,I]=g(!1),[v,O]=g(Array(6).fill("")),[k,B]=g([]),[N,E]=g(null),[R,T]=g({minutes:0,seconds:0}),[h,A]=g(!1),[p,V]=g(""),S=z(),[F]=G(),{isDarkMode:b}=H(),[be,{Form:J}]=ee();Q(()=>{const t=JSON.parse(localStorage.getItem("otpRequest")||"null");t?(E(new Date(t.expired_at).getTime()),V(t.email)):S("/auth/login",{replace:!0})}),U(()=>{const t=N();if(t){const s=setInterval(()=>{const n=new Date().getTime(),r=t-n;if(r<=0)clearInterval(s),A(!0),T({minutes:0,seconds:0});else{const $=Math.floor(r%36e5/6e4),e=Math.floor(r%(1e3*60)/1e3);T({minutes:$,seconds:e}),A(!1)}},1e3);W(()=>clearInterval(s))}});const P=(t,s)=>{const n=t.target.value;if(!/^\d*$/.test(n))return;const r=[...v()],$=n.slice(-1);r[s]=$,O(r),$&&s<5&&setTimeout(()=>{const e=k()[s+1];e&&e.focus()},0)},K=(t,s)=>{if(!/^\d$/.test(t.key)&&!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(t.key)&&t.preventDefault(),t.key==="Backspace"&&!v()[s]&&s>0){const n=[...v()];n[s-1]="",O(n),k()[s-1].focus()}},X=async t=>{const s=v().join("");if(h()){D();return}if(s.length===6){I(!0);try{const n={email:p(),otp_code:s},r=await j.verifyOtp(n);q.success(r?.success),localStorage.removeItem("otpRequest"),S("/auth/login",{replace:!0})}catch(n){console.error("OTP verification failed:",n)}finally{I(!1)}}},D=async()=>{try{const t=await j.resendOtp({email:p()});q.success(t.success),localStorage.setItem("otpRequest",JSON.stringify({email:p(),expired_at:t.expired_at})),E(new Date(t.expired_at).getTime())}catch{L()}},L=async()=>{p()&&(await j.deletePendingMember(p()),S("/auth/login",{replace:!0})),localStorage.removeItem("otpRequest")};return(()=>{var t=ae(),s=t.firstChild,n=s.firstChild,r=n.nextSibling,$=r.firstChild;return l(s,ie),i(n,c(u,{key:"otp.title"})),i(r,c(u,{key:"otp.enterCode"}),$),i(r,(()=>{var e=C(()=>!!p());return()=>e()&&`${p()[0]}****${p().split("@")[0].at(-1)}@${p().split("@")[1]}`})(),null),i(t,c(J,{onSubmit:X,get class(){return ue(b())},get children(){return[(()=>{var e=te(),o=e.firstChild,d=o.nextSibling;return i(o,c(u,{key:"otp.otpCode"})),i(d,()=>Array(6).fill(0).map((w,_)=>(()=>{var m=le();return Y(f=>{const M=k();M[_]=f,B(M)},m),m.addEventListener("focus",f=>f.target.select()),m.$$keydown=f=>K(f,_),m.$$input=f=>P(f,_),y(()=>l(m,de(b()))),y(()=>m.value=v()[_]),m})())),y(()=>l(o,pe(b()))),e})(),(()=>{var e=se(),o=e.firstChild;return l(e,ye),i(o,(()=>{var d=C(()=>!!h());return()=>d()?c(u,{key:"otp.otpExpired"}):F("otp.otpExpires",{minutes:String(R().minutes).padStart(2,"0"),seconds:String(R().seconds).padStart(2,"0")})})()),y(()=>l(o,h()?ve:xe)),e})(),(()=>{var e=ne();return l(e,me),i(e,(()=>{var o=C(()=>!!h());return()=>o()?c(u,{key:"otp.getNewOtp"}):C(()=>!!a())()?c(u,{key:"otp.verifying"}):c(u,{key:"otp.verify"})})()),y(()=>e.disabled=a()||!h()&&v().join("").length!==6),e})(),(()=>{var e=oe(),o=e.firstChild,d=o.firstChild,w=d.nextSibling;return i(o,c(u,{key:"otp.didntReceive"}),d),w.$$click=D,l(w,fe),i(w,c(u,{key:"otp.resendOtp"})),y(()=>l(o,`text-sm ${b()?"text-gray-300":"text-gray-600"}`)),e})(),(()=>{var e=re();return e.$$click=L,l(e,ge),i(e,c(u,{key:"otp.backToLogin"})),e})()]}}),null),y(e=>{var o=ce(b()),d=`${b()?"text-gray-300":"text-gray-600"}`;return o!==e.e&&l(n,e.e=o),d!==e.t&&l(r,e.t=d),e},{e:void 0,t:void 0}),t})()},ie="text-center",ce=a=>`text-4xl font-extrabold ${a?"text-gray-100":"text-gray-900"} mb-2`,ue=a=>["mt-8 space-y-6",a?"bg-gray-800 text-white":"bg-white","p-8","rounded-2xl shadow-lg"].join(" "),pe=a=>`block text-sm font-medium ${a?"text-gray-200":"text-gray-700"} mb-2`,de=a=>["w-12 h-12","text-center text-xl font-semibold",a?"bg-gray-700 text-white":"bg-white text-gray-900",a?"border-gray-600":"border-gray-300","border rounded-md","focus:border-blue-500 focus:outline-none"].join(" "),me=["w-full flex justify-center","py-3 px-4 rounded-xl","shadow-sm text-sm font-medium","text-white btn-primary"].join(" "),fe=["font-medium","text-blue-600","hover:text-blue-500"].join(" "),ge=["text-center mt-2 text-sm","font-medium text-blue-600","hover:text-blue-500 cursor-pointer"].join(" "),ye=["text-center my-4"].join(" "),xe=["text-sm font-medium","py-2 px-4","bg-blue-50","text-blue-700","rounded-lg"].join(" "),ve=["text-sm font-medium","py-2 px-4","bg-red-50","text-red-700","rounded-lg"].join(" ");Z(["click","input","keydown"]);export{we as default};
