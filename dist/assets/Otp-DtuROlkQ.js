import{c as b,u as G,I as H,a as Q,o as U,j as W,k as Y,t as h,e as c,i as u,b as d,X as f,f as C,l as Z,d as x,h as B,n as tt}from"./index-DbMwMWgQ.js";import{c as et,a as E}from"./authService-DV_9Ebx2.js";var st=h('<div class=space-y-5><label></label><div class="flex justify-between gap-2">'),at=h("<div><p>"),ot=h("<button type=submit>"),rt=h('<div class="text-center mt-4"><p> <button type=button>'),nt=h("<div>"),lt=h('<div class="max-w-md w-full space-y-8"><div><h1></h1><p> '),it=h("<input type=text inputmode=numeric pattern=[0-9]* maxlength=1 autocomplete=off>");const kt=()=>{const[o,O]=b(!1),[$,S]=b(Array(6).fill("")),[w,K]=b([]),[N,j]=b(null),[I,T]=b({minutes:0,seconds:0}),[k,R]=b(!1),[g,P]=b(""),D=G(),[V]=H(),{isDarkMode:p}=Q(),[ht,{Form:F}]=et();U(()=>{const t=JSON.parse(localStorage.getItem("otpRequest")||"null");t?(j(new Date(t.expired_at).getTime()),P(t.email)):D("/auth/login",{replace:!0})}),W(()=>{const t=N();if(t){const s=setInterval(()=>{const a=new Date().getTime(),n=t-a;if(n<=0)clearInterval(s),R(!0),T({minutes:0,seconds:0});else{const v=Math.floor(n%36e5/6e4),e=Math.floor(n%(1e3*60)/1e3);T({minutes:v,seconds:e}),R(!1)}},1e3);Y(()=>clearInterval(s))}});const J=(t,s)=>{const a=t.target.value;if(!/^\d*$/.test(a))return;const n=[...$()],v=a.slice(-1);n[s]=v,S(n),v&&s<5&&setTimeout(()=>{const e=w()[s+1];e&&e.focus()},0)},X=(t,s)=>{if(!/^\d$/.test(t.key)&&!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(t.key)&&(t.key==="v"&&(t.ctrlKey||t.metaKey)||t.preventDefault()),t.key==="v"&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),navigator.clipboard.readText().then(a=>{A({preventDefault:()=>{},clipboardData:{getData:()=>a}})}).catch(a=>{console.error("Failed to read clipboard contents: ",a)})),t.key==="ArrowLeft"&&s>0&&(t.preventDefault(),w()[s-1].focus()),t.key==="ArrowRight"&&s<5&&(t.preventDefault(),w()[s+1].focus()),t.key==="Backspace"&&!$()[s]&&s>0){const a=[...$()];a[s-1]="",S(a),w()[s-1].focus()}},A=(t,s)=>{t.preventDefault();const a=t.clipboardData.getData("text").trim();if(/^\d{6}$/.test(a)){const n=a.split(""),v=Array(6).fill("");n.forEach((e,r)=>{v[r]=e}),S(v),setTimeout(()=>{w()[5].focus()},0)}},z=async t=>{const s=$().join("");if(k()){L();return}if(s.length===6){O(!0);try{const a={email:g(),otp_code:s},n=await E.verifyOtp(a);B.success(n?.success),localStorage.removeItem("otpRequest"),D("/auth/login",{replace:!0})}catch(a){console.error("OTP verification failed:",a)}finally{O(!1)}}},L=async()=>{try{const t=await E.resendOtp({email:g()});B.success(t.success),localStorage.setItem("otpRequest",JSON.stringify({email:g(),expired_at:t.expired_at})),j(new Date(t.expired_at).getTime())}catch{M()}},M=async()=>{g()&&(await E.deletePendingMember(g()),D("/auth/login",{replace:!0})),localStorage.removeItem("otpRequest")};return(()=>{var t=lt(),s=t.firstChild,a=s.firstChild,n=a.nextSibling,v=n.firstChild;return c(s,ct),u(a,d(f,{key:"otp.title"})),u(n,d(f,{key:"otp.enterCode"}),v),u(n,(()=>{var e=C(()=>!!g());return()=>e()&&`${g()[0]}****${g().split("@")[0].at(-1)}@${g().split("@")[1]}`})(),null),u(t,d(F,{onSubmit:z,get class(){return dt(p())},get children(){return[(()=>{var e=st(),r=e.firstChild,y=r.nextSibling;return u(r,d(f,{key:"otp.otpCode"})),u(y,()=>Array(6).fill(0).map((_,m)=>(()=>{var i=it();return Z(l=>{const q=w();q[m]=l,K(q)},i),i.addEventListener("focus",l=>l.target.select()),i.addEventListener("paste",l=>A(l)),i.$$keydown=l=>X(l,m),i.$$input=l=>J(l,m),x(()=>c(i,mt(p()))),x(()=>i.value=$()[m]),i})())),x(()=>c(r,pt(p()))),e})(),(()=>{var e=at(),r=e.firstChild;return c(e,yt),u(r,(()=>{var y=C(()=>!!k());return()=>y()?d(f,{key:"otp.otpExpired"}):V("otp.otpExpires",{minutes:String(I().minutes).padStart(2,"0"),seconds:String(I().seconds).padStart(2,"0")})})()),x(()=>c(r,k()?bt(p()):xt(p()))),e})(),(()=>{var e=ot();return c(e,ft),u(e,(()=>{var r=C(()=>!!k());return()=>r()?d(f,{key:"otp.getNewOtp"}):C(()=>!!o())()?d(f,{key:"otp.verifying"}):d(f,{key:"otp.verify"})})()),x(()=>e.disabled=o()||!k()&&$().join("").length!==6),e})(),(()=>{var e=rt(),r=e.firstChild,y=r.firstChild,_=y.nextSibling;return u(r,d(f,{key:"otp.didntReceive"}),y),_.$$click=L,u(_,d(f,{key:"otp.resendOtp"})),x(m=>{var i=`text-sm ${p()?"text-gray-300":"text-gray-600"}`,l=gt(p());return i!==m.e&&c(r,m.e=i),l!==m.t&&c(_,m.t=l),m},{e:void 0,t:void 0}),e})(),(()=>{var e=nt();return e.$$click=M,u(e,d(f,{key:"otp.backToLogin"})),x(()=>c(e,vt(p()))),e})()]}}),null),x(e=>{var r=ut(p()),y=`${p()?"text-gray-300":"text-gray-600"}`;return r!==e.e&&c(a,e.e=r),y!==e.t&&c(n,e.t=y),e},{e:void 0,t:void 0}),t})()},ct="text-center",ut=o=>`text-4xl font-extrabold ${o?"text-gray-100":"text-gray-900"} mb-2`,dt=o=>["mt-8 space-y-6",o?"bg-gray-800 text-white":"bg-white","p-8","rounded-2xl shadow-lg"].join(" "),pt=o=>`block text-sm font-medium ${o?"text-gray-200":"text-gray-700"} mb-2`,mt=o=>["w-12 h-12","text-center text-xl font-semibold",o?"bg-gray-700 text-white":"bg-white text-gray-900",o?"border-gray-600":"border-gray-300","border rounded-md","focus:border-blue-500 focus:outline-none"].join(" "),ft=["w-full flex justify-center","py-3 px-4 rounded-xl","shadow-sm text-sm font-medium","text-white btn-primary"].join(" "),gt=o=>["font-medium",o?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-500"].join(" "),vt=o=>["text-center mt-2 text-sm","font-medium",o?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-500","cursor-pointer"].join(" "),yt=["text-center my-4"].join(" "),xt=o=>["text-sm font-medium","py-2 px-4",o?"bg-blue-900 text-blue-100":"bg-blue-50 text-blue-700","rounded-lg"].join(" "),bt=o=>["text-sm font-medium","py-2 px-4",o?"bg-red-900 text-red-100":"bg-red-50 text-red-700","rounded-lg"].join(" ");tt(["click","input","keydown"]);export{kt as default};
